{% extends 'dashboard/base.html' %}
{% load widget_tag %}

{% block head %}
    <style>
        #sortable { list-style-type: none; margin: 10px; padding: 0; }
        #sortable li { margin: 3px 3px 3px 0; padding: 1px; float: left; width: 750px; height: 600px; font-size: 4em; text-align: center; }
    </style>
    <script>
        jQuery(document).ready(function($) {
            $("#sortable").sortable();
            /*$('.sortable-object').each(function(){ 
                $(this).resizable({ alsoReduce: 'div' }); 
            });*/

            //$("#sortable").disableSelection();
            $("#sortable").bind("sortupdate", function() {
                $("#redrawer").click();
                var id_order = new Array();
                $(".sortable-object").each(function() {
                    var widget_id = $(this).attr("data-id");
                    id_order.push(widget_id);
                });
                $.ajax({
                    type: "POST",
                    url: "{% url widget_order dashboard_name=dashboard.name %}",
                    data: "ids=" + id_order,
                    success: function() { console.log("success-order"); }
                });
            });
        });

    </script>

    {% for widget in widgets %}
        {% widget_tag_head widget %} 
    {% endfor %}

{% endblock %}

{% block body %}

    <input id="redrawer" type="submit" />
    <div class="demo">

        <ul id="sortable">
            {% for widget in widgets %}
            <li class="ui-state-default sortable-object" data-id="{{ widget.id }}" style="z-index: -100;">{% widget_tag_body widget %}</li>
            {% endfor %}
        </ul>
        <!-- TODO setup ajax call on sort update -->

    </div><!-- End demo -->

{% endblock %}
