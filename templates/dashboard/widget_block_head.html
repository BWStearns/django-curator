    <script type='text/javascript'>
        
      function loadChart{{ widget.id }}() {
        $("#data_loading_img{{ widget.id }}").show();
        //data.addColumn('number', '{{ widget.get_model_display }}.{{ widget.datetime_field }}');
        var data = [
            // Add a blank row because google charts blows up otherwise.
            //[undefined, undefined],
        ];
        
        var options = {
            xaxis: { mode: "time" },
            yaxis: { min: 0 },
            /*         height: .9 * {{ widget.height }},
                hAxis: {
                    //TODO set this with ajax
                    //showTextEvery: {{ time_intervals }},
                },
                legend: 'bottom',
                width: {{ widget.width }},*/
        }
        
        chart_data[{{ widget.id }}] = data;
        chart_options[{{ widget.id }}] = options;
        redrawChart({{ widget.id }});

        //TODO make this call own function and only call it going forward
        $.ajax({
            method: "GET",
            dataType: 'json',
            url: "{% url widget_data widget.id %}",
            success: function(json_data) { 
                console.log("success-data-ajax: " + json_data['data_points'].length);
                $.each(json_data['data_points'], function(index, value) {
                    value[0] = new Date(value[0]).getTime();
                    data.push(value);
                });
                options.xaxis = {
                    mode: "time",
                    ticks: json_data['time_intervals'],
                    min: data[0][0],
                    max: data[data.length-1][0],
                }    

                chart_data[{{ widget.id }}] = data;
                chart_options[{{ widget.id }}] = options;
                redrawChart({{ widget.id }});
                $("#data_loading_img{{ widget.id }}").hide();
            }
        });
      }

      jQuery(document).ready(function($) {

          $("#fullscreen_btn{{ widget.id }}").live("click", function() {
              window.open("{% url widget_view widget.id %}", 'window', ',type=fullWindow,fullscreen,scrollbars=no,top=0,left=0,height=' + screen.height + ',width=' + screen.width);
          });
            
          $("#redrawer").live('click', function() {
              redrawChart({{ widget.id }});
          });
        
          $("#fullscreen_btn{{ widget.id }}").button({
              text: false,
              icons: {
                  primary: "ui-icon-plusthick"
              }
          });
          
          $("#reload_btn{{ widget.id }}").button({
                text: false,
                icons: {
                    primary: "ui-icon-arrowrefresh-1-e"
                }
          });
          
          $("#reload_btn{{ widget.id }}").live("click", function() {
              loadChart{{ widget.id }}();
          });

          loadChart{{ widget.id }}();
      });
    </script>

